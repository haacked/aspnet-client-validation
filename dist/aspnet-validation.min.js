!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.aspnetValidation=e():t.aspnetValidation=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"isValidatable",(function(){return s})),n.d(e,"MvcValidationProviders",(function(){return d})),n.d(e,"ValidationService",(function(){return c}));var r=function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function s(t){try{l(r.next(t))}catch(t){i(t)}}function o(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,o)}l((r=r.apply(t,e||[])).next())}))},a=function(t,e){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},i=new(function(){function t(){this.warn=globalThis.console.warn}return t.prototype.log=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]},t}()),s=function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement},o=["input","select","textarea"],l=function(t){return o.map((function(e){return"".concat(e).concat(t||"")})).join(",")};function u(t,e){var n=t.name,r=e.substring(2),a=n.lastIndexOf(".");if(a>-1){var i=n.substring(0,a)+"."+r,o=document.getElementsByName(i)[0];if(s(o))return o}return t.form.querySelector(l("[name=".concat(r,"]")))}var d=function(){this.required=function(t,e,n){var r=e.type.toLowerCase();if("checkbox"===r||"radio"===r){for(var a=0,i=Array.from(e.form.querySelectorAll(l("[name='".concat(e.name,"'][type='").concat(r,"']"))));a<i.length;a++){var s=i[a];if(s instanceof HTMLInputElement&&!0===s.checked)return!0}if("checkbox"===r){var o=e.form.querySelector("input[name='".concat(e.name,"'][type='hidden']"));if(o instanceof HTMLInputElement&&"false"===o.value)return!0}return!1}return Boolean(t)},this.stringLength=function(t,e,n){if(!t)return!0;if(n.min){var r=parseInt(n.min);if(t.length<r)return!1}if(n.max){var a=parseInt(n.max);if(t.length>a)return!1}return!0},this.compare=function(t,e,n){if(!n.other)return!0;var r=u(e,n.other);return!r||r.value===t},this.range=function(t,e,n){if(!t)return!0;var r=parseFloat(t);return!isNaN(r)&&(!(n.min&&r<parseFloat(n.min))&&!(n.max&&r>parseFloat(n.max)))},this.regex=function(t,e,n){return!t||!n.pattern||new RegExp(n.pattern).test(t)},this.email=function(t,e,n){return!t||/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$/.test(t)},this.creditcard=function(t,e,n){if(!t)return!0;if(/[^0-9 \-]+/.test(t))return!1;var r,a,i=0,s=0,o=!1;if((t=t.replace(/\D/g,"")).length<13||t.length>19)return!1;for(r=t.length-1;r>=0;r--)a=t.charAt(r),s=parseInt(a,10),o&&(s*=2)>9&&(s-=9),i+=s,o=!o;return i%10==0},this.url=function(t,e,n){if(!t)return!0;var r=t.toLowerCase();return r.indexOf("http://")>-1||r.indexOf("https://")>-1||r.indexOf("ftp://")>-1},this.phone=function(t,e,n){return!t||!/[\+\-\s][\-\s]/g.test(t)&&/^\+?[0-9\-\s]+$/.test(t)},this.remote=function(t,e,n){if(!t)return!0;for(var r=n.additionalfields.split(","),a={},i=0,s=r;i<s.length;i++){var o=s[i],l=o.substr(2),d=u(e,o);Boolean(d&&d.value)&&(d instanceof HTMLInputElement&&("checkbox"===d.type||"radio"===d.type)?a[l]=d.checked?d.value:"":a[l]=d.value)}var c=n.url,f=[];for(var l in a){var m=encodeURIComponent(l)+"="+encodeURIComponent(a[l]);f.push(m)}var h=f.join("&");return new Promise((function(t,e){var r=new XMLHttpRequest;if(n.type&&"post"===n.type.toLowerCase()){var i=new FormData;for(var s in a)i.append(s,a[s]);r.open("post",c),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(h)}else r.open("get",c+"?"+h),r.send();r.onload=function(n){if(r.status>=200&&r.status<300){var a=JSON.parse(r.responseText);t(a)}else e({status:r.status,statusText:r.statusText,data:r.responseText})},r.onerror=function(t){e({status:r.status,statusText:r.statusText,data:r.responseText})}}))}},c=function(){function t(t){var e=this;this.providers={},this.messageFor={},this.elementUIDs=[],this.elementByUID={},this.formInputs={},this.validators={},this.formEvents={},this.inputEvents={},this.summary={},this.debounce=300,this.allowHiddenFields=!1,this.validateForm=function(t,n){if(!(t instanceof HTMLFormElement))throw new Error("validateForm() can only be called on <form> elements");var r=e.getElementUID(t),a=e.formEvents[r];a&&a(void 0,n)},this.validateField=function(t,n){var r=e.getElementUID(t),a=e.inputEvents[r];a&&a(void 0,n)},this.preValidate=function(t){t.preventDefault(),t.stopImmediatePropagation()},this.handleValidated=function(t,n,r){if(!(t instanceof HTMLFormElement))throw new Error("handleValidated() can only be called on <form> elements");n?r&&e.submitValidForm(t,r):e.focusFirstInvalid(t)},this.submitValidForm=function(t,e){if(!(t instanceof HTMLFormElement))throw new Error("submitValidForm() can only be called on <form> elements");var n=new SubmitEvent("submit",e);if(t.dispatchEvent(n)){var r=e.submitter,a=t.action;if(r){var i=r.getAttribute("name");if(i){var s=document.createElement("input");s.type="hidden",s.name=i,s.value=r.getAttribute("value"),t.appendChild(s)}var o=r.getAttribute("formaction");o&&(t.action=o)}try{t.submit()}finally{t.action=a}}},this.focusFirstInvalid=function(t){if(!(t instanceof HTMLFormElement))throw new Error("focusFirstInvalid() can only be called on <form> elements");var n=e.getElementUID(t),r=e.formInputs[n].filter((function(t){return e.summary[t]}));if(r.length>0){var a=e.elementByUID[r[0]];a&&a.focus()}},this.isValid=function(t,n,r){if(void 0===n&&(n=!0),!(t instanceof HTMLFormElement))throw new Error("isValid() can only be called on <form> elements");n&&e.validateForm(t,r);var a=e.getElementUID(t);return 0==e.formInputs[a].filter((function(t){return e.summary[t]})).length},this.isFieldValid=function(t,n,r){void 0===n&&(n=!0),n&&e.validateField(t,r);var a=e.getElementUID(t);return void 0===e.summary[a]},this.options={root:document.body,watch:!1,addNoValidate:!0},this.ValidationInputCssClassName="input-validation-error",this.ValidationInputValidCssClassName="input-validation-valid",this.ValidationMessageCssClassName="field-validation-error",this.ValidationMessageValidCssClassName="field-validation-valid",this.ValidationSummaryCssClassName="validation-summary-errors",this.ValidationSummaryValidCssClassName="validation-summary-valid",this.logger=t||i}return t.prototype.addProvider=function(t,e){this.providers[t]||(this.logger.log("Registered provider: %s",t),this.providers[t]=e)},t.prototype.addMvcProviders=function(){var t=new d;this.addProvider("required",t.required),this.addProvider("length",t.stringLength),this.addProvider("maxlength",t.stringLength),this.addProvider("minlength",t.stringLength),this.addProvider("equalto",t.compare),this.addProvider("range",t.range),this.addProvider("regex",t.regex),this.addProvider("creditcard",t.creditcard),this.addProvider("email",t.email),this.addProvider("url",t.url),this.addProvider("phone",t.phone),this.addProvider("remote",t.remote)},t.prototype.scanMessages=function(t,e){void 0===e&&(e=!1);for(var n=0,r=Array.from(t.querySelectorAll("span[form]"));n<r.length;n++){var a=r[n];(u=document.getElementById(a.getAttribute("form")))&&(e?this.removeValidationMessageSpan(u,a):this.pushValidationMessageSpan(u,a))}var i=Array.from(t.querySelectorAll("form"));t instanceof HTMLFormElement&&i.push(t);var s=t instanceof Element?t.closest("form"):null;s&&i.push(s);for(var o=0,l=i;o<l.length;o++)for(var u=l[o],d=0,c=Array.from(u.querySelectorAll("[data-valmsg-for]"));d<c.length;d++){a=c[d];e?this.removeValidationMessageSpan(u,a):this.pushValidationMessageSpan(u,a)}},t.prototype.pushValidationMessageSpan=function(t,e){var n=this.getElementUID(t),r="".concat(n,":").concat(e.getAttribute("data-valmsg-for")),a=this.messageFor[r]||(this.messageFor[r]=[]);a.indexOf(e)<0?a.push(e):this.logger.log("Validation element for '%s' is already tracked",r,e)},t.prototype.removeValidationMessageSpan=function(t,e){var n=this.getElementUID(t),r="".concat(n,":").concat(e.getAttribute("data-valmsg-for")),a=this.messageFor[r];if(a){var i=a.indexOf(e);i>=0?a.splice(i,1):this.logger.log("Validation element for '%s' was already removed",r,e)}},t.prototype.parseDirectives=function(t){for(var e={},n={},r="data-val-".length,a=0;a<t.length;a++){var i=t[a];if(0===i.name.indexOf("data-val-")){var s=i.name.substr(r);n[s]=i.value}}var o=function(t){if(-1===t.indexOf("-")){for(var r=Object.keys(n).filter((function(e){return e!==t&&0===e.indexOf(t)})),a={error:n[t],params:{}},i=(t+"-").length,s=0;s<r.length;s++){var o=n[r[s]],l=r[s].substr(i);a.params[l]=o}e[t]=a}};for(var s in n)o(s);return e},t.prototype.guid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},t.prototype.getElementUID=function(t){var e=this.elementUIDs.filter((function(e){return e.node===t}))[0];if(e)return e.uid;var n=this.guid4();return this.elementUIDs.push({node:t,uid:n}),this.elementByUID[n]=t,n},t.prototype.getFormValidationTask=function(t){var e=this.formInputs[t];if(!e||0===e.length)return Promise.resolve(!0);for(var n=[],r=0;r<e.length;r++){var a=e[r],i=this.validators[a];i&&n.push(i)}var s=n.map((function(t){return t()}));return Promise.all(s).then((function(t){return t.every((function(t){return t}))}))},t.prototype.getMessageFor=function(t){if(!t.form)return[];var e=this.getElementUID(t.form),n="".concat(e,":").concat(t.name);return this.messageFor[n]},t.prototype.shouldValidate=function(t){return!(t&&t.submitter&&t.submitter.formNoValidate)},t.prototype.trackFormInput=function(t,e){var n=this,i=this.getElementUID(t);if(this.formInputs[i]||(this.formInputs[i]=[]),-1===this.formInputs[i].indexOf(e)?(this.formInputs[i].push(e),this.options.addNoValidate?(this.logger.log("Setting novalidate on form",t),t.setAttribute("novalidate","novalidate")):this.logger.log("Not setting novalidate on form",t)):this.logger.log("Form input for UID '%s' is already tracked",e),!this.formEvents[i]){var s=!1,o=function(e,o){if(!s&&n.shouldValidate(e)){var l=n.getFormValidationTask(i);l&&(e&&n.preValidate(e),s=!0,n.logger.log("Validating",t),l.then((function(i){return r(n,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return this.logger.log("Validated (success = %s)",i,t),o?(o(i),[2]):(n=new CustomEvent("validation",{detail:{valid:i}}),t.dispatchEvent(n),[4,new Promise((function(t){return setTimeout(t,0)}))]);case 1:return r.sent(),this.handleValidated(t,i,e),[2]}}))}))})).catch((function(t){n.logger.log("Validation error",t)})).finally((function(){s=!1})))}};t.addEventListener("submit",o),t.addEventListener("reset",(function(t){for(var e=0,r=n.formInputs[i];e<r.length;e++){var a=r[e],s=n.elementByUID[a];s.classList.contains(n.ValidationInputCssClassName)&&s.classList.remove(n.ValidationInputCssClassName),s.classList.contains(n.ValidationInputValidCssClassName)&&s.classList.remove(n.ValidationInputValidCssClassName);var o=n.getMessageFor(s);if(o)for(var l=0;l<o.length;l++)o[l].innerHTML="";delete n.summary[a]}n.renderSummary()})),this.formEvents[i]=o}},t.prototype.untrackFormInput=function(t,e){var n=this.getElementUID(t);if(this.formInputs[n]){var r=this.formInputs[n].indexOf(e);r>=0?this.formInputs[n].splice(r,1):this.logger.log("Form input for UID '%s' was already removed",e)}},t.prototype.addInput=function(t){var e=this,n=this.getElementUID(t),r=this.parseDirectives(t.attributes);if(this.validators[n]=this.createValidator(t,r),t.form&&this.trackFormInput(t.form,n),!this.inputEvents[n]){var a=0,i=function(t,r){var i=e.validators[n];clearTimeout(a),a=setTimeout((function(){i().then(r).catch((function(t){e.logger.log("Validation error",t)}))}),e.debounce)},s=t.dataset.valEvent;if(s)t.addEventListener(s,i);else{var o=t instanceof HTMLSelectElement?"change":"input";t.addEventListener(o,i)}this.inputEvents[n]=i}},t.prototype.removeInput=function(t){var e=this.getElementUID(t);delete this.summary[e],delete this.inputEvents[e],delete this.validators[e],t.form&&this.untrackFormInput(t.form,e)},t.prototype.scanInputs=function(t,e){void 0===e&&(e=!1);var n=Array.from(t.querySelectorAll(l('[data-val="true"]')));s(t)&&"true"===t.getAttribute("data-val")&&n.push(t);for(var r=0;r<n.length;r++){var a=n[r];e?this.removeInput(a):this.addInput(a)}},t.prototype.createSummaryDOM=function(){if(!Object.keys(this.summary).length)return null;var t=[],e=document.createElement("ul");for(var n in this.summary){var r=this.elementByUID[n];if((!(r instanceof HTMLInputElement)||"checkbox"!==r.type&&"radio"!==r.type||r.className!==this.ValidationInputValidCssClassName)&&!(t.indexOf(this.summary[n])>-1)){var a=document.createElement("li");a.innerHTML=this.summary[n],e.appendChild(a),t.push(this.summary[n])}}return e},t.prototype.renderSummary=function(){var t=document.querySelectorAll('[data-valmsg-summary="true"]');if(t.length){var e=JSON.stringify(this.summary,Object.keys(this.summary).sort());if(e!==this.renderedSummaryJSON){this.renderedSummaryJSON=e;for(var n=this.createSummaryDOM(),r=0;r<t.length;r++){for(var a=t[r],i=a.querySelectorAll("ul"),s=0;s<i.length;s++)i[s].remove();n&&n.hasChildNodes()?(this.swapClasses(a,this.ValidationSummaryCssClassName,this.ValidationSummaryValidCssClassName),a.appendChild(n.cloneNode(!0))):this.swapClasses(a,this.ValidationSummaryValidCssClassName,this.ValidationSummaryCssClassName)}}}},t.prototype.addError=function(t,e){var n=this.getMessageFor(t);if(n)for(var r=0;r<n.length;r++){n[r];n[r].innerHTML=e,this.swapClasses(n[r],this.ValidationMessageCssClassName,this.ValidationMessageValidCssClassName)}if(this.swapClasses(t,this.ValidationInputCssClassName,this.ValidationInputValidCssClassName),t.form){var a=t.form.querySelectorAll(l('[name="'.concat(t.name,'"]')));for(r=0;r<a.length;r++){this.swapClasses(a[r],this.ValidationInputCssClassName,this.ValidationInputValidCssClassName);var i=this.getElementUID(a[r]);this.summary[i]=e}}this.renderSummary()},t.prototype.removeError=function(t){var e=this.getMessageFor(t);if(e)for(var n=0;n<e.length;n++)e[n].innerHTML="",this.swapClasses(e[n],this.ValidationMessageValidCssClassName,this.ValidationMessageCssClassName);if(this.swapClasses(t,this.ValidationInputValidCssClassName,this.ValidationInputCssClassName),t.form){var r=t.form.querySelectorAll(l('[name="'.concat(t.name,'"]')));for(n=0;n<r.length;n++){this.swapClasses(r[n],this.ValidationInputValidCssClassName,this.ValidationInputCssClassName);var a=this.getElementUID(r[n]);delete this.summary[a]}}this.renderSummary()},t.prototype.createValidator=function(t,e){var n=this;return function(){return r(n,void 0,void 0,(function(){var n,r,i,s,o,l,u,d,c,f,m;return a(this,(function(a){switch(a.label){case 0:if(this.isHidden(t))return[3,7];for(i in r=[],n=e)r.push(i);s=0,a.label=1;case 1:return s<r.length?(i=r[s])in n?(l=e[o=i],(u=this.providers[o])?(this.logger.log("Running %s validator on element",o,t),d=u(t.value,t,l.params),c=!1,f=l.error,"boolean"!=typeof d?[3,2]:(c=d,[3,5])):(this.logger.log("aspnet-validation provider not implemented: %s",o),[3,6])):[3,6]:[3,7];case 2:return"string"!=typeof d?[3,3]:(c=!1,f=d,[3,5]);case 3:return[4,d];case 4:"boolean"==typeof(m=a.sent())?c=m:(c=!1,f=m),a.label=5;case 5:if(!c)return this.addError(t,f),[2,!1];a.label=6;case 6:return s++,[3,1];case 7:return this.removeError(t),[2,!0]}}))}))}},t.prototype.isHidden=function(t){return!(this.allowHiddenFields||t.offsetWidth||t.offsetHeight||t.getClientRects().length)},t.prototype.swapClasses=function(t,e,n){e&&!t.classList.contains(e)&&t.classList.add(e),t.classList.contains(n)&&t.classList.remove(n)},t.prototype.bootstrap=function(t){var e=this;Object.assign(this.options,t),this.addMvcProviders();var n=window.document,r=this.options.root,a=function(){e.scan(r),e.options.watch&&e.watch(r)};"complete"===n.readyState||"interactive"===n.readyState?a():n.addEventListener("DOMContentLoaded",a)},t.prototype.scan=function(t){this.logger.log("Scanning",t),this.scanMessages(t),this.scanInputs(t)},t.prototype.remove=function(t){this.logger.log("Removing",t),this.scanMessages(t,!0),this.scanInputs(t,!0)},t.prototype.watch=function(t){var e=this;this.observer=new MutationObserver((function(t){t.forEach((function(t){e.observed(t)}))})),this.observer.observe(t,{attributes:!0,childList:!0,subtree:!0}),this.logger.log("Watching for mutations")},t.prototype.observed=function(t){var e,n,r;if("childList"===t.type){for(var a=0;a<t.addedNodes.length;a++){var i=t.addedNodes[a];this.logger.log("Added node",i),i instanceof HTMLElement&&this.scan(i)}for(a=0;a<t.removedNodes.length;a++){i=t.removedNodes[a];this.logger.log("Removed node",i),i instanceof HTMLElement&&this.remove(i)}}else if("attributes"===t.type&&t.target instanceof HTMLElement){var s=null!==(e=t.oldValue)&&void 0!==e?e:"",o=null!==(r=null===(n=t.target.attributes[t.attributeName])||void 0===n?void 0:n.value)&&void 0!==r?r:"";this.logger.log("Attribute '%s' changed from '%s' to '%s'",t.attributeName,s,o,t.target),s!==o&&this.scan(t.target)}},t}()}])}));
//# sourceMappingURL=aspnet-validation.min.js.map