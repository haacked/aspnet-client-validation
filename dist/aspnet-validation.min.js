!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.aspnetValidation=e():t.aspnetValidation=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"MvcValidationProviders",(function(){return o})),r.d(e,"ValidationService",(function(){return u}));var n=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function o(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,o)}u((n=n.apply(t,e||[])).next())}))},a=function(t,e){var r,n,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},i=new(function(){function t(){}return t.prototype.log=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r]},t}());function s(t,e){var r=e.substr(2),n=t.lastIndexOf(".");if(n>-1){var a=t.substr(0,n)+"."+r,i=document.getElementsByName(a)[0];if(i)return i}return document.getElementsByName(r)[0]}var o=function(){this.required=function(t,e,r){return Boolean(t)},this.stringLength=function(t,e,r){if(!t)return!0;if(r.min){var n=parseInt(r.min);if(t.length<n)return!1}if(r.max){var a=parseInt(r.max);if(t.length>a)return!1}return!0},this.compare=function(t,e,r){if(!r.other)return!0;var n=s(e.name,r.other);return!n||n.value===t},this.range=function(t,e,r){if(!t)return!0;var n=parseFloat(t);return!isNaN(n)&&(!(r.min&&n<parseFloat(r.min))&&!(r.max&&n>parseFloat(r.max)))},this.regex=function(t,e,r){return!t||!r.pattern||new RegExp(r.pattern).test(t)},this.email=function(t,e,r){return!t||/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$/.test(t)},this.creditcard=function(t,e,r){if(!t)return!0;if(/[^0-9 \-]+/.test(t))return!1;var n,a,i=0,s=0,o=!1;if((t=t.replace(/\D/g,"")).length<13||t.length>19)return!1;for(n=t.length-1;n>=0;n--)a=t.charAt(n),s=parseInt(a,10),o&&(s*=2)>9&&(s-=9),i+=s,o=!o;return i%10==0},this.url=function(t,e,r){if(!t)return!0;var n=t.toLowerCase();return n.indexOf("http://")>-1||n.indexOf("https://")>-1||n.indexOf("ftp://")>-1},this.phone=function(t,e,r){return!t||!/[\+\-\s][\-\s]/g.test(t)&&/^\+?[0-9\-\s]+$/.test(t)},this.remote=function(t,e,r){if(!t)return!0;for(var n=r.additionalfields.split(","),a={},i=0,o=n;i<o.length;i++){var u=o[i],l=u.substr(2),d=s(e.name,u);Boolean(d&&d.value)&&(a[l]=d.value)}var f=r.url,c=[];for(var l in a){var m=encodeURIComponent(l)+"="+encodeURIComponent(a[l]);c.push(m)}var h=c.join("&");return new Promise((function(t,e){var n=new XMLHttpRequest;if("Post"===r.type){var i=new FormData;for(var s in a)i.append(s,a[s]);n.open("post",f),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(h)}else n.open("get",f+"?"+h),n.send();n.onload=function(r){if(n.status>=200&&n.status<300){var a=JSON.parse(n.responseText);t(a)}else e({status:n.status,statusText:n.statusText,data:n.responseText})},n.onerror=function(t){e({status:n.status,statusText:n.statusText,data:n.responseText})}}))}},u=function(){function t(t){var e=this;this.providers={},this.messageFor={},this.elementUIDs=[],this.elementByUID={},this.formInputs={},this.validators={},this.elementEvents={},this.summary={},this.debounce=300,this.allowHiddenFields=!1,this.validateForm=function(t,r){var n=e.getElementUID(t),a=e.elementEvents[n];a&&a(null,r)},this.focusFirstInvalid=function(t){var r=e.getElementUID(t),n=e.formInputs[r].filter((function(t){return e.summary[t]}));if(n.length>0){var a=e.elementByUID[n[0]];a&&a.focus()}},this.isValid=function(t,r,n){void 0===r&&(r=!0),r&&e.validateForm(t,n);var a=e.getElementUID(t);return 0==e.formInputs[a].filter((function(t){return e.summary[t]})).length},this.isFieldValid=function(t,r,n){if(void 0===r&&(r=!0),r){var a=t.closest("form");null!=a&&e.validateForm(a,n)}var i=e.getElementUID(t);return null!=e.summary[i]},this.ValidationInputCssClassName="input-validation-error",this.ValidationInputValidCssClassName="input-validation-valid",this.ValidationMessageCssClassName="field-validation-error",this.ValidationMessageValidCssClassName="field-validation-valid",this.logger=t||i}return t.prototype.addProvider=function(t,e){this.providers[t]||(this.logger.log("Registered provider: "+t),this.providers[t]=e)},t.prototype.addMvcProviders=function(){var t=new o;this.addProvider("required",t.required),this.addProvider("length",t.stringLength),this.addProvider("maxlength",t.stringLength),this.addProvider("minlength",t.stringLength),this.addProvider("equalto",t.compare),this.addProvider("range",t.range),this.addProvider("regex",t.regex),this.addProvider("creditcard",t.creditcard),this.addProvider("email",t.email),this.addProvider("url",t.url),this.addProvider("phone",t.phone),this.addProvider("remote",t.remote)},t.prototype.scanMessages=function(t){var e=Array.from(t.querySelectorAll("[data-valmsg-for]"));t.hasAttribute("data-valmsg-for")&&e.push(t);for(var r=0;r<e.length;r++){var n=e[r],a=n.getAttribute("data-valmsg-for");this.messageFor[a]||(this.messageFor[a]=[]),this.messageFor[a].push(n)}},t.prototype.parseDirectives=function(t){for(var e={},r={},n="data-val-".length,a=0;a<t.length;a++){var i=t[a];if(0===i.name.indexOf("data-val-")){var s=i.name.substr(n);r[s]=i.value}}var o=function(t){if(-1===t.indexOf("-")){for(var n=Object.keys(r).filter((function(e){return e!==t&&0===e.indexOf(t)})),a={error:r[t],params:{}},i=(t+"-").length,s=0;s<n.length;s++){var o=r[n[s]],u=n[s].substr(i);a.params[u]=o}e[t]=a}};for(var s in r)o(s);return e},t.prototype.guid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},t.prototype.getElementUID=function(t){var e=this.elementUIDs.filter((function(e){return e.node===t}))[0];if(e)return e.uid;var r=this.guid4();return this.elementUIDs.push({node:t,uid:r}),this.elementByUID[r]=t,r},t.prototype.getFormValidationTask=function(t){var e=this.formInputs[t];if(!e||0===e.length)return null;for(var r=[],n=0;n<e.length;n++){var a=e[n];r.push(this.validators[a])}var i=r.map((function(t){return t()}));return Promise.all(i).then((function(t){return t.every((function(t){return t}))}))},t.prototype.shouldValidate=function(t){return!(null!==t&&t.submitter&&t.submitter.formNoValidate)},t.prototype.trackFormInput=function(t,e){var r=this,n=this.getElementUID(t);if(this.formInputs[n]||(this.formInputs[n]=[]),-1===this.formInputs[n].indexOf(e)&&this.formInputs[n].push(e),!this.elementEvents[n]){var a=function(e,a){if(r.shouldValidate(e)){var i=r.getFormValidationTask(n);i&&i.then((function(n){var i=!e;if(n){if(i)return void a(!0);var s=new CustomEvent("validation",{detail:{valid:!0}});t.dispatchEvent(s)}else{e&&(e.preventDefault(),e.stopImmediatePropagation());var o=new CustomEvent("validation",{detail:{valid:!1}});t.dispatchEvent(o),i?a(!1):r.focusFirstInvalid(t)}})).catch((function(t){console.log(t)}))}};t.addEventListener("submit",a),t.addEventListener("reset",(function(t){for(var e=0,a=r.formInputs[n];e<a.length;e++){var i=a[e],s=r.elementByUID[i];s.classList.remove(r.ValidationInputCssClassName),s.classList.remove(r.ValidationInputValidCssClassName);var o=r.messageFor[s.name];if(o)for(var u=0;u<o.length;u++)o[u].innerHTML="";delete r.summary[i]}r.renderSummary()})),this.elementEvents[n]=a}},t.prototype.addInput=function(t){var e=this,r=this.getElementUID(t),n=this.parseDirectives(t.attributes),a=this.createValidator(t,n);if(this.validators[r]=a,t.form&&this.trackFormInput(t.form,r),!this.elementEvents[r]){var i,s=function(t){var n=e.validators[r];clearTimeout(i),i=setTimeout(n,e.debounce)},o="select"===t.tagName.toLowerCase(),u=t.dataset.valEvent;o?t.addEventListener("change",s):u?t.addEventListener(u,s):t.addEventListener("input",s),this.elementEvents[r]=s}},t.prototype.scanInputs=function(t){var e=Array.from(t.querySelectorAll('[data-val="true"]'));"true"===t.getAttribute("data-val")&&e.push(t);for(var r=0;r<e.length;r++){var n=e[r];this.addInput(n)}},t.prototype.createSummaryDOM=function(){if(!Object.keys(this.summary).length)return null;var t=document.createElement("ul");for(var e in this.summary){var r=document.createElement("li");r.innerHTML=this.summary[e],t.appendChild(r)}return t},t.prototype.renderSummary=function(){var t=document.querySelectorAll('[data-valmsg-summary="true"]');if(t.length){var e=JSON.stringify(this.summary,Object.keys(this.summary).sort());if(e!==this.renderedSummaryJSON){this.renderedSummaryJSON=e;for(var r=this.createSummaryDOM(),n=0;n<t.length;n++){var a=t[n];a.innerHTML="",r?(a.className="validation-summary-errors",a.appendChild(r.cloneNode(!0))):a.className="validation-summary-valid"}}}},t.prototype.addError=function(t,e){var r=this.messageFor[t.name];if(r)for(var n=0;n<r.length;n++)r[n].innerHTML=e,r[n].className=this.ValidationMessageCssClassName;t.classList.remove(this.ValidationInputValidCssClassName),t.classList.add(this.ValidationInputCssClassName);var a=this.getElementUID(t);this.summary[a]=e,this.renderSummary()},t.prototype.removeError=function(t){var e=this.messageFor[t.name];if(e)for(var r=0;r<e.length;r++)e[r].innerHTML="",e[r].className=this.ValidationMessageValidCssClassName;t.classList.remove(this.ValidationInputCssClassName),t.classList.add(this.ValidationInputValidCssClassName);var n=this.getElementUID(t);delete this.summary[n],this.renderSummary()},t.prototype.createValidator=function(t,e){var r=this;return function(){return n(r,void 0,void 0,(function(){var r,n,i,s,o,u,l,d,f,c;return a(this,(function(a){switch(a.label){case 0:if(this.isHidden(t))return[3,7];for(n in r=[],e)r.push(n);i=0,a.label=1;case 1:return i<r.length?(s=r[i],o=e[s],(u=this.providers[s])?(this.logger.log("Running "+s+" validator on element",t),l=u(t.value,t,o.params),d=!1,f=o.error,"boolean"!=typeof l?[3,2]:(d=l,[3,5])):(console.log("aspnet-validation provider not implemented: "+s),[3,6])):[3,7];case 2:return"string"!=typeof l?[3,3]:(d=!1,f=l,[3,5]);case 3:return[4,l];case 4:"boolean"==typeof(c=a.sent())?d=c:(d=!1,f=c),a.label=5;case 5:if(!d)return this.addError(t,f),[2,!1];a.label=6;case 6:return i++,[3,1];case 7:return this.removeError(t),[2,!0]}}))}))}},t.prototype.isHidden=function(t){return!(this.allowHiddenFields||t.offsetWidth||t.offsetHeight||t.getClientRects().length)},t.prototype.bootstrap=function(t){var e=this;t=t||{},this.addMvcProviders();var r=window.document;"complete"===r.readyState||"interactive"===r.readyState?this.scan(t.root||window.document.body):window.document.addEventListener("DOMContentLoaded",(function(r){e.scan(t.root||window.document.body)})),t.watch&&this.watch(t.root)},t.prototype.scan=function(t){this.scanMessages(t),this.scanInputs(t)},t.prototype.watch=function(t){var e=this;this.observer=new MutationObserver((function(t){t.forEach((function(t){e.observed(t)}))})),this.observer.observe(t,{attributes:!0,childList:!0,subtree:!0}),this.logger.log("Watching for mutations")},t.prototype.observed=function(t){if("childList"===t.type)for(var e=0;e<t.addedNodes.length;e++){var r=t.addedNodes[e];r instanceof HTMLElement&&this.scan(r)}else"attributes"===t.type&&t.target instanceof HTMLElement&&this.scan(t.target)},t}()}])}));
//# sourceMappingURL=aspnet-validation.min.js.map